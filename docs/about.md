# サーバーとは
## サーバーの存在意義
サーバーを用いることで、クライアント ( 主にブラウザのこと、詳しくは後述 ) 同士で相互にデータをやりとりしたり、データやサービス ( プログラム ) を多くの人に利用させることができる

### データベース
サーバーが大量のデータを保持・利用する場合、変数を使っていてはプログラムが停止したとき消えてしまったり、テキストファイルに書き出していては読み書きが遅くなってしまう

データベースはセキュリティ上の理由から、直接ではなくサーバーを介して操作される

データベースを使うと、簡単・安全にデータを集約することができる

### リアルタイム通信
複数台のコンピュータ間で同期した通信を行う場合、サーバーがタイミングを
合わせる役目をすることが多い

## 言語
PHPやRubyがよく使われるが、JavaScriptでもPythonでもC++でもだいたいどれでも書ける

## クライアントとの関係
### バックエンド？フロントエンド？
バックエンドとフロントエンドという区分を聞いたことがあるかもしれない

バックエンドはサーバーやデータベース、インフラなどユーザーに意識されない部分を指し、フロントエンドはブラウザやアプリなどのユーザーの目に触れる部分を指す

概ね、バックエンド = サーバーサイド、フロントエンド = クライアントサイドと認識してよい

### やりとりの仕方
クライアントからリクエストを送信し、サーバーがそれに対するレスポンスを返す

#### プロトコルとは
「protocol」は「取り決め / 協定 / 手続き」などといった意味の英単語で、そのとおり、コンピュータ間でデータをやりとりするための決まりを定めたもの

プロトコルには

- HTTP
	- HyperText Transfer Protocol
	- 主にHTML文書の通信に利用
- FTP
	- File Transfer Protocol
	- ファイル転送に利用
- SSH
	- Secure Shell Protocol
	- 遠隔操作に利用
- DHCP
	- Dynamic Host Configuration Protocol
	- IPアドレスの割当てに利用
- NTP
	- Network Time Protocol
	- 時計合わせに利用

などがある

詳しくは、[3分間ネットワーク基礎講座](https://drive.google.com/open?id=10wfgOFDve3TuHCtCKXi10J1QHzqTjhfL) 58ページから

#### HTTP
HTTPはインターネット上の文書の送受信のために作られたプロトコル

##### リクエスト・レスポンス
HTTPでは、リクエストと呼ばれるデータを通信先のアドレスに向かって送信し、それに対して通信先のコンピュータがレスポンスというデータを返してくる、という形で一連の通信が行われる

リクエストを送る側をクライアント、リクエストを受け取ってレスポンスを送る側をサーバーと呼ぶ

リクエストやレスポンスには、ヘッダー ( header ) とボディ ( body ) がある

ヘッダーにはボディのデータ形式など通信に必要なメタデータが、ボディには通信の目的を果たすための情報が含まれる

##### HTTPメソッド
HTTPで通信を行うとき、その通信の目的に応じてメソッドを使う

主に以下のメソッドが使われる

- GET
	- 情報をサーバーから取得する
- POST
	- 情報をサーバーに送信する
- PUT
	- サーバー上の情報を更新する
- DELETE
	- サーバーから情報を削除する

#### HTTPS
HTTPSはHTTPに暗号化の機能を追加したもの ( HTTP over SSL/TLS ) であり、厳密にはHTTPSというプロトコルはない

> TLS ( Transport Layer Security ) は、HTTPなどよりも深い層にあるプロトコルで、HTTPの他にもFTPやSMTP ( メール送受信用のプロトコル ) なども暗号化できる

#### IPアドレスとポート
IPアドレスは、ネットワーク上でコンピュータを特定するための番号で、よく使われるのはIPv4アドレスだが近年のコンピュータ数の増加によって枯渇しており、IPv6に移行するシステムも少なくない

ポートは、アプリケーションごとに分けて使用されるコンピュータ内のアドレスのようなもの

- 0 - 1023
	- WELL KNOWN PORT NUMBERS ( 一般的なポート番号 )
	- 使用にはroot ( 管理者 ) 権限が必要
- 1024 - 49151
	- REGISTERED PORT NUMBERS ( 登録済みポート番号 )
- 49152 - 65535
	- DYNAMIC AND/OR PRIVATE PORTS ( 自由に使用できるポート番号 )

HTTPは80番、HTTPSは443番、SSHは22番など、アプリケーションごとに使うポート番号が決まっている

同一のポートは同時に1つのアプリケーションしかlisten ( 通信待機状態になること ) ができない

サーバーのデバッグによく使われるのはHTTPの80番に見かけが近い8000番、8080番や2000番、3000番など

URLは、
```shell
<プロトコル>://<アドレス>:<ポート>
```
の形になっている

たとえば、IPアドレス```172.217.26.14```の```80```番ポートに```http```を使ってアクセスするとき、
```shell
http://172.217.26.14:80
```

UNIX系OSでは、```172.0.0.1```というIPアドレスが自身を指し、```localhost```としてもアクセスできる

### API
API ( Application Programing Interface ) とは、サービスをプログラム上から利用するための窓口のようなもの

仕様に従ってリクエストを送信すると、サービスがそれに対応した動作をする

#### エンドポイント
APIのリクエスト先URLとプロトコルをあわせてエンドポイントと呼ぶが、大抵プロトコルはHTTPなので実質URLと同義

### CORS
サーバーは原則として、同一オリジン ( = 同一ドメイン ) 上のWebアプリケーションにのみ、そのリソース ( 情報資源や計算資源 ) を提供する

試しに適当なページでConsoleを開き、
```js
fetch("https://google.com").then(res => res.json.then(json => console.log(json)))
```
を実行してみると
```shell
Access to fetch at 'https://google.com/' from origin 'https://example.com' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.
```
というようなエラーが出る

これは ```https://google.com``` にGETリクエストを送信してレスポンスをConsoleに表示するような命令であるが、google.comはCORSをオフにしているのでリクエストがブロックされたことを表している

CORS ( Cross-Origin Resource Sharing ) とは、異なるオリジンのWebアプリケーションにリソースを共有できるようにするもの

初期設定ではCORSはオフになっているので、利用したい場合はサーバー側に設定が必要

参考: [ExpressにおけるCORSの設定](https://expressjs.com/en/resources/middleware/cors.html)
